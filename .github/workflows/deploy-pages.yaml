name: Upload Build Summary (No Pages)

on:
  workflow_run:
    workflows: ["Build and Push Wisdom Layer Image"]
    types:
      - completed

jobs:
  build-summary:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: ‚¨áÔ∏è Checkout repo
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: üìÑ Generate static HTML summary
      run: |
        mkdir -p dashboard
        cat <<EOF > dashboard/index.html
        <!DOCTYPE html>
        <html>
        <head>
          <title>Build Summary</title>
        </head>
        <body>
          <h1>Wisdom Layer ‚Äì Build Summary</h1>
          <p><strong>Build ID:</strong> wisdom-${{ github.run_id }}</p>
          <p><strong>Timestamp:</strong> ${GITHUB_RUN_STARTED_AT}</p>
          <p><strong>View Full Build:</strong>
            <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}">
              GitHub Actions Run #${{ github.run_id }}
            </a>
          </p>
          <h2>Attached Scan Results</h2>
          <ul>
            <li><code>trivy-vuln-scan.json</code> and <code>.csv</code></li>
            <li><code>trivy-sbom.cdx.json</code> and <code>.csv</code></li>
          </ul>
        </body>
        </html>
        EOF

    - name: üì§ Upload summary dashboard
      uses: actions/upload-artifact@v4
      with:
        name: build-summary
        path: dashboard
        if-no-files-found: error
        retention-days: 7
