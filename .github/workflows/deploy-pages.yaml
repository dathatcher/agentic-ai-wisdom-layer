name: Deploy Build Summary to GitHub Pages

on:
  workflow_run:
    workflows: ["Build and Push Wisdom Layer Image"]
    types:
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    environment:
      name: github-pages

    permissions:
      contents: write
      pages: write
      id-token: write

    steps:
    - name: ðŸ§¾ Create GitHub Pages content
      run: |
        mkdir -p public
        cat <<EOF > public/index.html
        <!DOCTYPE html>
        <html>
        <head><title>Wisdom Layer Build Summary</title></head>
        <body>
          <h1>Latest Build Summary</h1>
          <p><strong>Build:</strong> wisdom-${{ github.run_id }}</p>
          <p><strong>Run:</strong> <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}">GitHub Actions Run #${{ github.run_id }}</a></p>
          <ul>
            <li>ðŸ”— <code>trivy-vuln-scan.json</code> + <code>.csv</code> in build artifacts</li>
            <li>ðŸ”— <code>trivy-sbom.cdx.json</code> + <code>.csv</code> in build artifacts</li>
          </ul>
        </body>
        </html>
        EOF

    - name: ðŸ“¦ Upload artifact for Pages
      uses: actions/upload-artifact@v4
      with:
        name: github-pages
        path: public

    - name: ðŸš€ Deploy to GitHub Pages
      uses: actions/deploy-pages@v4
